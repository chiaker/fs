# Техническое задание
## Веб-приложение для знакомств (Dating App)

---

## 1. Общее описание проекта

### 1.1. Назначение
Веб-приложение для знакомств с интерфейсом в стиле Tinder, позволяющее пользователям создавать профили, просматривать других пользователей, выражать симпатию и находить взаимные совпадения (мэтчи).

### 1.2. Целевая аудитория
- Пользователи, желающие найти знакомства
- Администраторы для управления тестовыми данными

### 1.3. Технологический стек
- **Backend**: C++17 (нативный HTTP-сервер)
- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **UI Framework**: Bootstrap 5.3.3
- **Хранение данных**: Файловая система (текстовый формат)
- **Сетевые библиотеки**: WinSock2 (Windows) / POSIX sockets (Linux)

---

## 2. Функциональные требования

### 2.1. Управление профилями пользователей

#### 2.1.1. Создание профиля
- **Описание**: Пользователь может создать свой профиль через веб-интерфейс
- **Поля профиля**:
  - Имя (обязательное)
  - Возраст (опциональное)
  - О себе / Биография (опциональное)
  - Email / Контакт (обязательное)
  - Фотография (опциональное, загружается через форму)
- **Валидация**:
  - Имя и контакт обязательны для заполнения
  - Email должен быть в корректном формате
  - Фотография принимается в форматах: PNG, JPEG, GIF
- **Результат**: Создается уникальный ID пользователя, профиль сохраняется в базе данных

#### 2.1.2. Просмотр списка пользователей
- **Описание**: Получение списка всех зарегистрированных пользователей
- **Формат ответа**: JSON массив с информацией о пользователях
- **Поля в ответе**: id, name, age, bio, photo (URL)

### 2.2. Система симпатий и мэтчей

#### 2.2.1. Выражение симпатии (Like)
- **Описание**: Пользователь может выразить симпатию другому пользователю
- **Механизм**:
  - При лайке система проверяет, лайкнул ли целевой пользователь текущего пользователя ранее
  - Если да - создается мэтч, контакты обоих пользователей становятся видимыми
  - Если нет - симпатия сохраняется, но мэтч не создается
- **Уведомление**: При создании мэтча пользователь получает уведомление с контактами

#### 2.2.2. Пропуск профиля (Skip/Dislike)
- **Описание**: Пользователь может пропустить профиль без выражения симпатии
- **Результат**: Профиль больше не показывается в текущей сессии просмотра

#### 2.2.3. Просмотр мэтчей
- **Описание**: Пользователь может просмотреть список всех своих мэтчей
- **Информация в мэтче**: Имя, контакт (email), фотография
- **Доступ**: Через отдельную страницу или кнопку в интерфейсе

### 2.3. Пользовательский интерфейс

#### 2.3.1. Главная страница
- **Модальное окно создания профиля**:
  - Отображается при первом посещении или если профиль не создан
  - Форма с полями для ввода данных
  - Валидация в реальном времени
  - Индикация процесса создания профиля

- **Область просмотра карточек**:
  - Отображение профилей в виде карточек в стиле Tinder
  - Карточка содержит: фотографию, имя, возраст, биографию
  - Поддержка свайпов мышью и касаниями (для мобильных устройств)
  - Анимации при свайпе влево/вправо

- **Кнопки действий**:
  - ❤️ Like (лайк) - выражение симпатии
  - ✕ Dislike (дизлайк) - пропуск профиля
  - ⭐ Super Like (супер лайк) - усиленное выражение симпатии

- **Навигация**:
  - Кнопка "Начать просмотр" для загрузки профилей
  - Кнопка "Matches" для перехода к списку мэтчей

#### 2.3.2. Страница мэтчей
- **Описание**: Отображение списка всех мэтчей пользователя
- **Элементы**:
  - Карточка мэтча с фотографией, именем и контактом
  - Возможность вернуться на главную страницу
- **Автозагрузка**: При наличии ID пользователя в localStorage или URL параметрах

#### 2.3.3. Админ-панель
- **Назначение**: Создание тестовых пользователей для демонстрации
- **Функции**:
  - Форма для добавления пользователей
  - Те же поля, что и в обычной форме создания профиля
- **Доступ**: Отдельная страница `/admin`

### 2.4. Загрузка и хранение файлов

#### 2.4.1. Загрузка фотографий
- **Формат**: Base64 data URL (передается через форму)
- **Обработка**: Декодирование и сохранение в папку `www/uploads/`
- **Именование**: Уникальное имя на основе временной метки (например, `img_1765561426048.png`)
- **Поддерживаемые форматы**: PNG, JPEG, GIF

#### 2.4.2. Отдача статических файлов
- **Описание**: Сервер отдает загруженные изображения по запросу
- **Путь**: `/uploads/<filename>`
- **Content-Type**: Определяется автоматически по расширению файла

---

## 3. Технические требования

### 3.1. Архитектура системы

#### 3.1.1. Backend (C++ сервер)
- **Тип**: Многопоточный HTTP-сервер
- **Порт**: 8080 (по умолчанию)
- **Обработка запросов**: Каждый клиент обрабатывается в отдельном потоке
- **Классы**:
  - `User` - модель пользователя
  - `ProfileManager` - управление профилями пользователей
  - `MatchManager` - управление симпатиями и мэтчами

#### 3.1.2. Frontend
- **Технологии**: HTML5, CSS3, JavaScript (Vanilla JS)
- **Стилизация**: Bootstrap 5.3.3 + кастомные стили
- **Хранение состояния**: localStorage для сохранения ID текущего пользователя
- **API**: RESTful API через HTTP запросы

### 3.2. API Endpoints

#### 3.2.1. GET `/` или `/index.html`
- **Описание**: Главная страница приложения
- **Ответ**: HTML страница

#### 3.2.2. GET `/matches.html`
- **Описание**: Страница со списком мэтчей
- **Ответ**: HTML страница

#### 3.2.3. GET `/admin` или `/admin.html`
- **Описание**: Админ-панель
- **Ответ**: HTML страница

#### 3.2.4. GET `/users`
- **Описание**: Получить список всех пользователей
- **Ответ**: JSON массив
- **Формат ответа**:
```json
[
  {
    "id": 1,
    "name": "Иван",
    "age": 25,
    "bio": "Описание",
    "photo": "/uploads/img_123.png"
  }
]
```

#### 3.2.5. POST `/create`
- **Описание**: Создать новый профиль пользователя
- **Тело запроса**: `application/x-www-form-urlencoded`
- **Параметры**:
  - `name` (обязательный) - имя пользователя
  - `age` (опциональный) - возраст
  - `bio` (опциональный) - биография
  - `contact` (обязательный) - email/контакт
  - `photo_data` (опциональный) - Base64 data URL фотографии
- **Ответ**: Текстовая строка `created id=<id>`

#### 3.2.6. POST `/like?user=<id>&target=<id>`
- **Описание**: Выразить симпатию пользователю
- **Параметры запроса**:
  - `user` - ID пользователя, который лайкает
  - `target` - ID пользователя, которого лайкают
- **Ответ**: Текстовая строка с результатом
  - При мэтче: `It's a match! Contact: <email>`
  - При обычном лайке: `Liked`

#### 3.2.7. GET `/matches?id=<id>`
- **Описание**: Получить список мэтчей пользователя
- **Параметры запроса**:
  - `id` - ID пользователя
- **Ответ**: JSON массив мэтчей
- **Формат ответа**:
```json
[
  {
    "id": 2,
    "name": "Мария",
    "contact": "maria@example.com",
    "photo": "/uploads/img_456.png"
  }
]
```

#### 3.2.8. GET `/stats`
- **Описание**: Получить статистику системы
- **Ответ**: Текстовая строка
- **Формат**: `total_users=<n>\ntotal_matches=<m>`

#### 3.2.9. GET `/uploads/<filename>`
- **Описание**: Получить загруженное изображение
- **Ответ**: Бинарные данные изображения
- **Content-Type**: Определяется по расширению файла

#### 3.2.10. OPTIONS `/*`
- **Описание**: CORS preflight запрос
- **Ответ**: Пустое тело с CORS заголовками

### 3.3. Хранение данных

#### 3.3.1. Формат хранения
- **Тип**: Текстовый файл
- **Путь**: `data/users.db` (относительно исполняемого файла)
- **Формат**: Одна строка на пользователя, сериализованные данные
- **Структура строки**: `id|name|age|bio|contact|photo|likes|matches`
  - `likes` и `matches` - списки ID через запятую

#### 3.3.2. Синхронизация
- **Многопоточность**: Используется `std::mutex` для защиты доступа к данным
- **Сохранение**: Данные сохраняются при изменении (создание пользователя, лайк)

### 3.4. Безопасность

#### 3.4.1. CORS
- **Настройка**: Разрешены запросы с любого источника (`Access-Control-Allow-Origin: *`)
- **Методы**: GET, POST, OPTIONS
- **Заголовки**: Content-Type

#### 3.4.2. Валидация данных
- **Клиентская**: Проверка обязательных полей, формата email
- **Серверная**: Проверка наличия обязательных полей перед созданием профиля

### 3.5. Производительность

#### 3.5.1. Обработка запросов
- **Многопоточность**: Каждый клиент обрабатывается в отдельном потоке
- **Буфер чтения**: 8192 байта для начального чтения запроса
- **Чтение тела**: Дополнительное чтение по Content-Length для больших запросов

#### 3.5.2. Оптимизация
- **Индексация**: Использование `std::map` для быстрого поиска пользователей по ID
- **Кэширование**: Профили загружаются в память при старте сервера

---

## 4. Требования к интерфейсу

### 4.1. Дизайн
- **Стиль**: Современный, минималистичный, вдохновленный Tinder
- **Цветовая схема**: Градиентный фон (фиолетово-синий), белые карточки
- **Шрифты**: Системные шрифты (San Francisco, Segoe UI, Roboto)

### 4.2. Адаптивность
- **Мобильные устройства**: Поддержка свайпов касаниями
- **Планшеты**: Адаптивная верстка
- **Десктоп**: Оптимальная ширина контента (максимум 420px для карточек)

### 4.3. Интерактивность
- **Анимации**:
  - Плавное появление/исчезновение карточек
  - Анимация свайпа с поворотом
  - Уведомления о мэтчах с масштабированием
- **Обратная связь**:
  - Визуальная индикация при наведении на кнопки
  - Блокировка кнопок во время обработки запросов
  - Сообщения об ошибках и успешных операциях

---

## 5. Требования к развертыванию

### 5.1. Системные требования
- **ОС**: Windows 10+ или Linux
- **Компилятор**: g++ (MinGW) или MSVC (Visual Studio)
- **Стандарт C++**: C++17 или выше
- **Библиотеки**: 
  - WinSock2 (Windows)
  - POSIX sockets (Linux)
  - STL (стандартная библиотека)

### 5.2. Сборка проекта
- **Скрипт сборки**: `build.ps1` (PowerShell)
- **Команда**: `.\build.ps1`
- **Результат**: Исполняемый файл `dating_server.exe`

### 5.3. Запуск
- **Команда**: `.\dating_server.exe`
- **Порт**: 8080
- **Доступ**: `http://localhost:8080`

### 5.4. Структура проекта
```
project/
├── src/              # Исходный код C++
│   ├── main.cpp      # HTTP сервер
│   ├── User.*        # Модель пользователя
│   ├── ProfileManager.*  # Управление профилями
│   └── MatchManager.*    # Управление мэтчами
├── www/              # Frontend файлы
│   ├── index.html    # Главная страница
│   ├── matches.html  # Страница мэтчей
│   ├── admin.html    # Админ-панель
│   ├── app.js        # Основная логика
│   ├── matches.js    # Логика мэтчей
│   ├── admin.js      # Логика админ-панели
│   ├── styles.css    # Стили
│   └── uploads/      # Загруженные изображения
├── data/             # База данных (создается автоматически)
│   └── users.db      # Файл с пользователями
├── build.ps1         # Скрипт сборки
└── README.md         # Документация
```

---

## 6. Ограничения и известные проблемы

### 6.1. Ограничения
- HTTP парсинг минималистичный, не production-ready
- Нет аутентификации и авторизации
- Нет защиты от SQL-инъекций (используется файловое хранилище)
- Нет шифрования данных
- Ограниченный размер буфера чтения (8192 байта)

### 6.2. Известные проблемы
- Большие файлы изображений могут вызвать проблемы с чтением запроса
- Нет обработки одновременных запросов на изменение одного пользователя
- Нет валидации размера загружаемых файлов

---

## 7. Планы развития

### 7.1. Краткосрочные улучшения
- Добавить валидацию размера загружаемых файлов
- Улучшить обработку ошибок
- Добавить логирование

### 7.2. Долгосрочные улучшения
- Добавить систему аутентификации
- Реализовать базу данных (SQLite/PostgreSQL)
- Добавить фильтры поиска (возраст, местоположение)
- Реализовать систему сообщений
- Добавить push-уведомления

---

## 8. Тестирование

### 8.1. Функциональное тестирование
- Создание профиля с различными данными
- Выражение симпатии и создание мэтчей
- Просмотр списка пользователей
- Загрузка и отображение фотографий

### 8.2. Тестирование интерфейса
- Проверка работы на разных браузерах
- Тестирование на мобильных устройствах
- Проверка адаптивности

### 8.3. Нагрузочное тестирование
- Одновременные запросы от нескольких клиентов
- Обработка больших объемов данных

---

**Версия документа**: 1.0  
**Дата создания**: 2024  
**Автор**: Разработчик проекта

